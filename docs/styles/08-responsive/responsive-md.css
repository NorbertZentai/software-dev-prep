/* === RESPONSIVE DESIGN === */
@media (max-width: 768px) {
  /* Grid layouts */
  .card-grid {
    grid-template-columns: 1fr;
    gap: var(--space-md);
  }

  /* Page headers */
  .page-meta-header {
    padding: var(--space-lg);
  }

  .page-title {
    font-size: var(--font-size-2xl);
  }

  .goals-list {
    grid-template-columns: 1fr;
  }

  /* Stats */
  .stats-overview {
    grid-template-columns: repeat(2, 1fr);
  }

  /* Starter links */
  .starter-buttons {
    flex-direction: column;
  }

  .starter-link {
    justify-content: center;
  }

  /* Layout changes */
  body {
    grid-template-columns: 1fr;
    grid-template-areas:
      'header'
      'main'
      'footer';
  }

  .sidebar {
    position: fixed;
    top: var(--header-height);
    left: -100%;
    width: var(--sidebar-width);
    height: calc(100vh - var(--header-height));
    z-index: 105;
    transition: left var(--transition-slow);
    border-radius: 0 var(--border-radius-lg) var(--border-radius-lg) 0;
    border-right: 2px solid var(--border-color);
    box-shadow: none;
  }

  .sidebar.open {
    left: 0;
    box-shadow: 4px 0 20px var(--shadow-color);
  }

  .sidebar-toggle {
    display: block;
  }

  .main-nav {
    display: none;
  }

  .header-content {
    gap: var(--space-md);
  }

  #search-input {
    width: 150px;
  }

  .main-content {
    padding: var(--space-xl) var(--space-lg) var(--space-lg);
  }

  .welcome-screen {
    padding: var(--space-lg) 0;
  }

  .quick-actions {
    grid-template-columns: 1fr;
  }

  /* Theory page mobile */
  .theory-page-container {
    flex-direction: column;
    gap: var(--space-lg);
    padding: var(--space-md);
    width: 100%;
  }

  .theory-sidebar {
    position: fixed;
    top: var(--header-height);
    left: 0;
    right: 0;
    width: auto;
    z-index: 999;
    box-shadow: 0 6px 20px var(--shadow-color);
    display: none;
    border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg);
  }

  .theory-sidebar.open {
    display: block;
  }

  .theory-sidebar .toc {
    max-height: calc(45vh - 2 * var(--space-md));
  }

  .toc-toggle {
    display: block;
  }

  .theory-content {
    padding: var(--space-xl) var(--space-lg);
    margin-left: 0;
  }

  .theory-header h1 {
    font-size: var(--font-size-2xl);
  }

  .concept-article .concept-title {
    font-size: var(--font-size-xl);
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-sm);
    margin-top: var(--space-lg);
  }

  .theory-navigation {
    flex-direction: column;
    gap: var(--space-md);
  }

  .theory-navigation .btn {
    width: 100%;
  }

  /* Hide desktop inline toolbar/menu on mobile */
  .theory-inline-toolbar,
  .theory-inline-menu { display: none !important; }

  /* Hide regular sidebar on theory pages for mobile */
  body.is-theory .sidebar { display: none; }
  body.is-theory .main-nav { display: none; }
  body.is-theory .header-tools #search-input { display: none; }

  /* Generic drawer panels */
  .drawer.left {
    position: fixed;
    top: var(--header-height);
    left: -100%;
    width: 85vw;
    max-width: 320px;
    height: calc(100vh - var(--header-height) - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px));
    z-index: 1001;
    background: var(--bg-secondary);
    border-right: 2px solid var(--border-color);
  /* Keep outer container non-scrollable so rounded corner clips scrollbar */
  overflow: hidden;
    -webkit-overflow-scrolling: touch;
  transition: left var(--transition-slow, 300ms);
    /* Outer padding removed to avoid double-padding with cloned .sidebar-content */
    padding: 0;
    /* Match right drawer rounding on exposed edge */
    border-radius: 0 var(--border-radius-lg) var(--border-radius-lg) 0;
  }
  .drawer.left.open { left: 0; box-shadow: 4px 0 20px var(--shadow-color); }

  .drawer.right {
    position: fixed;
    top: var(--header-height);
    right: -100%;
    left: auto !important;
    width: 85vw;
    max-width: 320px;
    height: calc(100vh - var(--header-height) - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px));
    z-index: 1001;
    background: var(--bg-secondary);
    border-left: 2px solid var(--border-color);
  /* Keep outer container non-scrollable so rounded corner clips scrollbar */
  overflow: hidden;
    -webkit-overflow-scrolling: touch;
  transition: right var(--transition-slow, 300ms);
    padding: 0;
    border-radius: var(--border-radius-lg) 0 0 var(--border-radius-lg);
  }
  .drawer.right.open { right: 0; box-shadow: -4px 0 20px var(--shadow-color); }

  /* Drawer panel - right side off-canvas (overrides desktop #theory-sidebar) */
  #theory-sidebar.theory-drawer.right {
    position: fixed;
    top: var(--header-height);
    right: -100%;
    left: auto !important;
    width: min(75vw, 260px);
    max-width: 260px;
    height: calc(100vh - var(--header-height));
    z-index: 1001;
    background: var(--bg-secondary);
    border-left: 2px solid var(--border-color);
    border-right: none;
    /* Allow scrolling with custom scrollbar */
    overflow-y: auto;
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
    transition: right var(--transition-slow, 300ms);
    padding: 0;
    box-shadow: none;
    border-radius: var(--border-radius-lg) 0 0 var(--border-radius-lg);
  }

  #theory-sidebar.theory-drawer.right.open {
    right: 0;
    box-shadow: -4px 0 20px var(--shadow-color);
  }

  /* Drawer content */
  .theory-drawer h3 {
    color: var(--accent-primary);
    font-size: var(--font-size-lg);
    margin-bottom: var(--space-md);
    border-bottom: 1px solid var(--border-color);
    padding-bottom: var(--space-sm);
  }

  /* Add consistent inner padding for both drawers */
  #global-nav .sidebar-content,
  #theory-sidebar .theory-toc,
  #theory-sidebar .sidebar-content {
    padding: var(--space-lg);
    height: 100%;
    max-height: 100%;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-gutter: stable both-edges;
  }

  .theory-drawer .toc-link {
    padding: var(--space-sm) var(--space-md);
    margin-bottom: var(--space-xs);
    border-radius: var(--border-radius);
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    min-height: 44px; /* mobile tap target */
    touch-action: manipulation;
  }

  .theory-drawer .toc-link:hover { background: var(--bg-accent); transform: none; }
  .theory-drawer .toc-link.active { background: var(--accent-primary); color: #fff; font-weight: 600; }

  /* Mobil: mindent visszaállítás normálra */
  body.is-theory {
    display: block !important;
    padding-top: 0 !important;
    gap: 0 !important;
    width: 100% !important;
  }

  /* App normál mobilon */
  body.is-theory #app {
    display: block !important;
    margin-left: 0 !important;
    padding: 0 !important;
  }

  /* Sidebar mobilon - TELJESEN OVERLAY */
  body.is-theory #sidebar,
  #sidebar {
    position: fixed !important;              /* NE foglaljon helyet */
    left: -100vw !important;                 /* teljesen képernyőn kívül */
    top: var(--header-height, 64px) !important;
    width: min(85vw, 360px) !important;
    height: calc(100dvh - var(--header-height, 64px)) !important;
    display: block !important;               /* láthatóságot ne a display vezérelje */
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;         /* rejtve ne fogjon eventet */
    z-index: 1100 !important;                /* tartalom FÖLÉ kerüljön */
    overflow-y: auto !important;
    background: var(--bg-secondary) !important;
    box-shadow: 20px 0 40px var(--shadow-color) !important;
    border-right: 1px solid var(--border-color) !important;
    padding: var(--space-md, 16px) !important;
    margin: 0 !important;
    float: none !important;
    grid-area: none !important;              /* nincs grid pozíció */
    transition:
      left .32s ease,
      opacity .24s ease,
      visibility 0s linear .32s !important;
  }
  
  /* SIDEBAR NYITOTT ÁLLAPOT - becsúszik balról */
  body.is-theory #sidebar.open,
  #sidebar.open {
    left: 0 !important;
    visibility: visible !important;
    opacity: 1 !important;
    pointer-events: auto !important;
    transition:
      left .32s ease,
      opacity .24s ease,
      visibility 0s linear 0s !important;
  }

  /* Theory sidebar mobilon - TELJESEN OVERLAY */
  body.is-theory #theory-sidebar,
  #theory-sidebar {
    position: fixed !important;              /* NE foglaljon helyet */
    right: -100vw !important;                /* teljesen képernyőn kívül */
    top: var(--header-height, 64px) !important;
    width: min(85vw, 360px) !important;
    height: calc(100dvh - var(--header-height, 64px)) !important;
    display: block !important;               /* láthatóságot ne a display vezérelje */
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;         /* rejtve ne fogjon eventet */
    z-index: 1100 !important;                /* tartalom FÖLÉ kerüljön */
    overflow-y: auto !important;
    background: var(--bg-secondary) !important;
    box-shadow: -20px 0 40px var(--shadow-color) !important;
    border-left: 1px solid var(--border-color) !important;
    padding: var(--space-md, 16px) !important;
    margin: 0 !important;
    float: none !important;
    grid-area: none !important;              /* nincs grid pozíció */
    transition:
      right .32s ease,
      opacity .24s ease,
      visibility 0s linear .32s !important;
  }
  
  /* THEORY SIDEBAR NYITOTT ÁLLAPOT - becsúszik jobbról */
  body.is-theory #theory-sidebar.open,
  #theory-sidebar.open {
    right: 0 !important;
    visibility: visible !important;
    opacity: 1 !important;
    pointer-events: auto !important;
    transition:
      right .32s ease,
      opacity .24s ease,
      visibility 0s linear 0s !important;
  }

  /* Theory content mobilon normál */
  body.is-theory #theory-content {
    position: static !important;
    margin: 0 !important;
    padding: var(--space-xl) var(--space-lg) var(--space-lg) var(--space-lg) !important; /* felső padding hozzáadva */
    width: 100% !important;
    border-radius: 0 !important;
    border: none !important;
    background: var(--bg-primary) !important;
    box-sizing: border-box !important;
    float: none !important;
  }

  /* Body scroll lock while drawer open */
  body.drawer-open {
    overflow: hidden;
    position: fixed;
    width: 100%;
  }

  /* Hide legacy floating TOC toggle in favor of header toggles */
  .toc-toggle { display: none !important; }

  /* Hard guard against horizontal overflow on mobile */
  * { min-width: 0; }
  .content-container, .concept-article, .card { overflow-wrap: anywhere; word-break: break-word; }
  img, svg, video, iframe { max-width: 100%; height: auto; display: block; }
}

/* === MOBIL DUAL DRAWER SYSTEM === */
@media (max-width: 768px) {
  /* Header layout mobilon */
  .header-content {
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
    gap: var(--space-sm) !important;
    padding: 0 var(--space-sm) !important;
  }

  /* Logo section középen */
  .logo-section {
    display: flex !important;
    align-items: center !important;
    flex: 1 !important;
    justify-content: center !important;
  }

  /* Main nav elrejtése mobilon */
  .main-nav {
    display: none !important;
  }

  /* Header tools kompakt */
  .header-tools {
    display: flex !important;
    align-items: center !important;
    gap: var(--space-xs) !important;
  }

  /* Search input kisebb mobilon */
  #search-input {
    width: 120px !important;
    font-size: 14px !important;
  }

  /* Hamburger ikonok stílusa */
  .mobile-nav-toggle,
  .mobile-toc-toggle {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    background: var(--bg-secondary) !important;
    color: var(--text-primary) !important;
    border: 2px solid var(--border-color) !important;
    border-radius: var(--border-radius) !important;
    padding: var(--space-sm) !important;
    width: 44px !important;
    height: 44px !important;
    font-size: 1.2rem !important;
    font-weight: bold !important;
    cursor: pointer !important;
    transition: all var(--transition-fast) !important;
    box-shadow: 0 2px 4px var(--shadow-color) !important;
    flex-shrink: 0 !important;
  }

  /* Bal hamburger pozicionálása */
  .mobile-nav-toggle {
    order: -1 !important;
    margin-right: var(--space-sm) !important;
  }

  /* Jobb hamburger pozicionálása */
  .mobile-toc-toggle {
    order: 10 !important;
    margin-left: var(--space-sm) !important;
    display: none !important; /* Alapból elrejtett */
  }

  /* Theory oldalakon jobb hamburger megjelenítése */
  body.is-theory .mobile-toc-toggle {
    display: flex !important;
  }

  /* Hover effektek */
  .mobile-nav-toggle:hover,
  .mobile-toc-toggle:hover {
    background: var(--bg-accent) !important;
    border-color: var(--accent-primary) !important;
    color: var(--accent-primary) !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 4px 8px var(--shadow-color) !important;
  }

  /* Aktív állapot */
  .mobile-nav-toggle[aria-expanded="true"],
  .mobile-toc-toggle[aria-expanded="true"] {
    background: var(--accent-primary) !important;
    color: #fff !important;
    border-color: var(--accent-primary) !important;
  }

  /* RÉGI ELEMEK ELREJTÉSE */
  .sidebar-toggle {
    display: none !important;
  }

  .theory-drawer-toggle {
    display: none !important;
  }

  /* Theory sidebar alapból TELJESEN elrejtett mobilon */
  #theory-sidebar {
    display: none !important;
  }

  /* Hidden utility felülírása is */
  #theory-sidebar.hidden {
    display: none !important;
  }

  /* BAL OLDALI NAVIGATION DRAWER */
  #sidebar {
    position: fixed !important;
    top: var(--header-height) !important;
    left: -100% !important;
    width: 85vw !important;
    max-width: 320px !important;
    height: calc(100vh - var(--header-height)) !important;
    background: var(--bg-secondary) !important;
    border-right: 2px solid var(--border-color) !important;
    z-index: 1001 !important;
    padding: var(--space-lg) !important;
    overflow-y: auto !important;
    transition: left 0.3s ease !important;
    box-shadow: 4px 0 20px var(--shadow-color) !important;
    border-radius: 0 var(--border-radius-lg) var(--border-radius-lg) 0 !important;
  }

  /* RÉGI SZABÁLY - kikommentálva, mert ütközik az újjal
  #sidebar.open {
    left: 0 !important;
  }
  */

  /* JOBB OLDALI TOC DRAWER */
  #theory-sidebar.drawer-open {
    display: block !important;
    position: fixed !important;
    top: var(--header-height) !important;
    right: -100% !important;
    width: 85vw !important;
    max-width: 320px !important;
    height: calc(100vh - var(--header-height)) !important;
    background: var(--bg-secondary) !important;
    border-left: 2px solid var(--border-color) !important;
    z-index: 1001 !important;
    padding: var(--space-lg) !important;
    overflow-y: auto !important;
    transition: right 0.3s ease !important;
    box-shadow: -4px 0 20px var(--shadow-color) !important;
    border-radius: var(--border-radius-lg) 0 0 var(--border-radius-lg) !important;
  }

  #theory-sidebar.drawer-open.open {
    right: 0 !important;
  }

  /* Jobb oldali TOC toggle gomb a headerben */
  body.is-theory #toc-toggle {
    display: inline-flex !important;
    align-items: center;
    justify-content: center;
    background: var(--bg-secondary);
    color: var(--text-primary);
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: var(--space-sm);
    width: 44px;
    height: 44px;
    font-size: 1.1rem;
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  body.is-theory #toc-toggle:hover {
    background: var(--bg-accent);
    border-color: var(--accent-primary);
    color: var(--accent-primary);
    transform: translateY(-1px);
    box-shadow: 0 2px 8px var(--shadow-color);
  }

  /* Drawer overlay */
  .drawer-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--shadow-color);
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
  }

  .drawer-overlay.active {
    opacity: 1;
    visibility: visible;
  }
}

/* === Mobile TOC drawer (≤768px) – modern right slide-in === */
@media (max-width: 768px) {
  /* A utilities .hidden ne tudja elrejteni a drawert, hogy animálhassuk */
  #theory-sidebar.hidden { display: block !important; }

  /* Overlay alapból rejtve */
  #drawer-overlay {
    position: fixed !important;
    inset: 0 !important;
    background: var(--shadow-color) !important;
    opacity: 0 !important;
    visibility: hidden !important;
    transition: opacity .25s ease !important;
    z-index: 1000 !important;
  }
  body.drawer-open-right #drawer-overlay { opacity: 1 !important; visibility: visible !important; }

  /* TOC drawer – alapállapot: teljesen kívül a jobb oldalon, nem klikkelhető */
  #theory-sidebar {
    position: fixed !important;
    top: var(--header-height, 64px) !important;
    right: -92vw !important;             /* teljesen kint */
    width: min(88vw, 340px) !important;
    height: calc(100vh - var(--header-height, 64px)) !important;
    display: block !important;            /* kell az animációhoz */
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
    transition: right .32s ease, opacity .25s ease, visibility 0s linear .32s !important;
    z-index: 1100 !important;

    /* Modern kinézet */
    background: var(--bg-secondary) !important;
    border-left: 1px solid rgba(255,255,255,.08) !important;
    box-shadow: 0 12px 40px var(--shadow-color) !important;
    backdrop-filter: saturate(140%) blur(6px);
    -webkit-backdrop-filter: saturate(140%) blur(6px);
    border-top-left-radius: 16px !important;
    border-bottom-left-radius: 16px !important;
    padding: var(--space-md, 16px) !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
  }

  /* Nyitott állapot */
  body.drawer-open-right #theory-sidebar.open {
    right: 0 !important;
    opacity: 1 !important;
    visibility: visible !important;
    pointer-events: auto !important;
    transition: right .32s ease, opacity .25s ease, visibility 0s linear 0s !important;
  }

  /* Body scroll lock nyitott állapotban */
  body.drawer-open-right { overflow: hidden !important; touch-action: none !important; }

  /* TOC belső elemek – finom modern stílusok */
  #theory-sidebar .theory-toc h3 {
    display: flex; align-items: center; gap: 8px;
    font-size: 1.05rem; font-weight: 700; letter-spacing: .2px;
    margin: 4px 0 12px;
  }
  #theory-sidebar .theory-toc #toc-search {
    width: 100%; border: 1px solid rgba(255,255,255,.12);
    background: var(--bg-accent); color: var(--text-primary);
    padding: 10px 12px; border-radius: 10px; outline: none;
  }
  #theory-sidebar .theory-toc a {
    display: block; padding: 12px 10px; margin: 4px 0;
    border-radius: 10px; text-decoration: none; color: var(--text-secondary);
    transition: transform .12s ease, background .12s ease, color .12s ease;
  }
  #theory-sidebar .theory-toc a:hover { transform: translateY(-1px); background: var(--bg-accent); color: var(--text-primary); }
  #theory-sidebar .theory-toc a.active { background: var(--accent-primary); color: #fff; box-shadow: 0 6px 16px var(--shadow-color); }
}

/* === Mobile TOC drawer (≤768px) – right slide-in, overlay, scroll lock === */
@media (max-width: 768px) {

  /* 1. Rejtsük el az in-content / desktop rail toggler gombot mobilon */
  .theory-hamburger,
  .toc-rail-toggle,
  #theory-top-toolbar {
    display: none !important;
  }

  /* 2. Drawer alapállapot: teljesen rejtve, jobb oldalon off-canvas */
  #theory-sidebar {
    position: fixed !important;
    top: var(--header-height, 64px) !important;
    right: -100vw !important;                /* teljesen kívül */
    width: min(85vw, 360px) !important;
    height: calc(100dvh - var(--header-height, 64px)) !important;
    display: block !important;               /* ne a display vezérelje a láthatóságot */
    visibility: hidden !important;
    opacity: 0 !important;
    background: var(--bg-secondary) !important;
    box-shadow: -20px 0 40px rgba(0,0,0,.35) !important;
    border-left: 1px solid color-mix(in oklab, white 8%, transparent) !important;
    z-index: 1002 !important;
    overflow-y: auto !important;
    overscroll-behavior: contain !important;
    -webkit-overflow-scrolling: touch !important;
    padding: var(--space-md, 16px) !important;
    transition:
      right .32s ease,
      opacity .24s ease,
      visibility 0s linear .32s !important;  /* visibility késleltetve záráskor */
    backdrop-filter: blur(6px) saturate(110%);
  }

  /* 3. Nyitott állapot – jobbról becsúszik, láthatóvá válik */
  #theory-sidebar.open {
    right: 0 !important;
    visibility: visible !important;
    opacity: 1 !important;
    transition:
      right .32s ease,
      opacity .24s ease,
      visibility 0s linear 0s !important;
  }

  /* 4. Overlay mobilon */
  #drawer-overlay {
    position: fixed !important;
    inset: 0 !important;
    background: rgba(0,0,0,.45) !important;
    opacity: 0 !important;
    visibility: hidden !important;
    transition: opacity .24s ease, visibility 0s linear .24s !important;
    z-index: 1001 !important;
  }
  #drawer-overlay.visible {
    opacity: 1 !important;
    visibility: visible !important;
    transition: opacity .24s ease, visibility 0s linear 0s !important;
  }

  /* 5) Body scroll lock nyitott állapotban (class-t JS adja a body-ra) */
  body.drawer-open-right,
  body.drawer-open-left {
    overflow: hidden !important;
    touch-action: none !important;
  }

  /* 6. TOC belsejének kis kozmetikája mobilon */
  #theory-sidebar .theory-toc h3 {
    font-size: 1.1rem;
    margin: 0 0 12px;
  }
  #theory-sidebar .theory-toc input[type="search"],
  #theory-sidebar .theory-toc input[type="text"] {
    width: 100%;
    height: 40px;
    border-radius: 10px;
    border: 1px solid color-mix(in oklab, #fff 10%, transparent);
    background: color-mix(in oklab, var(--bg-secondary) 92%, #fff 8%);
    outline: none;
    padding: 0 12px;
    margin: 6px 0 12px;
  }
  #theory-sidebar .theory-toc a {
    display: block;
    padding: 10px 12px;
    border-radius: 10px;
    text-decoration: none;
  }
  #theory-sidebar .theory-toc a:hover {
    background: color-mix(in oklab, #fff 8%, transparent);
  }
}

/* === MOBILE: TOC overlay, ne foglaljon helyet (≤768px) === */
@media (max-width: 768px) {
  /* 0) Tartalomban lévő rail/mini-hamburger teljes rejtése mobilon */
  .theory-hamburger,
  .toc-rail-toggle,
  #theory-top-toolbar { display: none !important; }

  /* 0.5) FONTOS: Mobilon felülírjuk a fő grid layout-ot */
  body {
    display: block !important;               /* nincs grid layout mobilon */
    grid-template-columns: none !important;
    grid-template-areas: none !important;
    grid-template-rows: none !important;
    padding-top: 0 !important;              /* nincs felső padding */
    margin-top: 0 !important;               /* nincs felső margin */
    overflow-x: hidden !important;          /* prevent horizontal scroll */
  }

  /* 0.6) Main container teljes szélességbe */
  #app,
  main {
    display: block !important;
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    grid-area: none !important;
    overflow-x: hidden !important;          /* prevent horizontal scroll */
  }

  /* 1) A TOC mindig kivegyük a flow-ból: fix + off-canvas alapból */
  /* ERŐSEBB SPECIFICITÁS: body.is-theory #theory-sidebar felülírásához */
  body.is-theory #theory-sidebar,
  #theory-sidebar {
    position: fixed !important;               /* NE foglaljon helyet */
    top: var(--header-height, 64px) !important;
    right: -100% !important;                 /* teljesen képernyőn kívül */
    width: min(80vw, 320px) !important;
    height: calc(100dvh - var(--header-height, 64px)) !important;
    display: block !important;                /* láthatóságot ne a display vezérelje */
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;          /* rejtve ne fogjon eventet */
    background: var(--bg-secondary) !important;
    box-shadow: -20px 0 40px rgba(0,0,0,.35) !important;
    border-left: 1px solid color-mix(in oklab, white 8%, transparent) !important;
    z-index: 1100 !important;                 /* tartalom FÖLÉ kerüljön */
    overflow-y: auto !important;
    overscroll-behavior: contain !important;
    -webkit-overflow-scrolling: touch !important;
    padding: var(--space-md, 16px) !important;
    transition:
      right .32s ease,
      opacity .24s ease,
      visibility 0s linear .32s !important;   /* záráskor késleltetett visibility */
    backdrop-filter: blur(6px) saturate(110%);
    /* FONTOS: felülírjuk a korábbi mobilos szabályokat */
    margin: 0 !important;
    float: none !important;
  }
  body.is-theory #theory-sidebar.open,
  #theory-sidebar.open {
    right: 0 !important;
    visibility: visible !important;
    opacity: 1 !important;
    pointer-events: auto !important;          /* nyitva kaphat eventet */
    transition:
      right .32s ease,
      opacity .24s ease,
      visibility 0s linear 0s !important;
  }

  /* 1.5) BAL OLDALI NAVIGATION SIDEBAR overlay stílusai */
  #sidebar {
    position: fixed !important;               /* NE foglaljon helyet */
    top: var(--header-height, 64px) !important;
    left: -100vw !important;                  /* teljesen képernyőn kívül */
    width: min(85vw, 360px) !important;
    height: calc(100dvh - var(--header-height, 64px)) !important;
    display: block !important;                /* láthatóságot ne a display vezérelje */
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;          /* rejtve ne fogjon eventet */
    background: var(--bg-secondary) !important;
    box-shadow: 20px 0 40px rgba(0,0,0,.35) !important;
    border-right: 1px solid color-mix(in oklab, white 8%, transparent) !important;
    z-index: 1100 !important;                 /* tartalom FÖLÉ kerüljön */
    overflow-y: auto !important;
    overscroll-behavior: contain !important;
    -webkit-overflow-scrolling: touch !important;
    padding: var(--space-md, 16px) !important;
    transition:
      left .32s ease,
      opacity .24s ease,
      visibility 0s linear .32s !important;   /* záráskor késleltetett visibility */
    backdrop-filter: blur(6px) saturate(110%);
    /* FONTOS: felülírjuk a korábbi mobilos szabályokat */
    margin: 0 !important;
    float: none !important;
    /* Grid area felülírása */
    grid-area: none !important;
  }
  #sidebar.open {
    left: 0 !important;
    visibility: visible !important;
    opacity: 1 !important;
    pointer-events: auto !important;          /* nyitva kaphat eventet */
    transition:
      left .32s ease,
      opacity .24s ease,
      visibility 0s linear 0s !important;
  }

  /* 2) Overlay a teljes képernyő fölé, a tartalom fölött, a TOC alá */
  #drawer-overlay {
    position: fixed !important;
    inset: 0 !important;
    background: rgba(0,0,0,.45) !important;
    opacity: 0 !important;
    visibility: hidden !important;
    pointer-events: none !important;          /* csak visible-kor fogjon */
    transition: opacity .24s ease, visibility 0s linear .24s !important;
    z-index: 1095 !important;                 /* a TOC (1100) alatt, tartalom fölött */
  }
  #drawer-overlay.visible {
    opacity: 1 !important;
    visibility: visible !important;
    pointer-events: auto !important;
    transition: opacity .24s ease, visibility 0s linear 0s !important;
  }

  /* 3) Ha bármilyen rács/kolonna helyet hagyna a TOC-nak, kapcsold ki */
  /* Keresztezett védelem: tipikus osztálynevek a projektben */
  .theory-layout,
  .theory-grid,
  .content-grid,
  .toc-rail,
  #toc-rail,
  #toc-column,
  #theory-sidebar-host,
  #theory-sidebar-placeholder,
  .theory-page-container {
    display: none !important;                 /* ne maradjon üres hely */
  }

  /* 4) A fő tartalom mindig foglalja a teljes szélességet mobilon */
  main,
  #content,
  #theory-content,
  .page-content,
  .content {
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 !important;
    padding-top: 0 !important;           /* nincs felső padding */
  }

  /* 4.1) ÁLTALÁNOS RESET: minden lehetséges container elem */
  .container,
  .wrapper,
  .page-wrapper,
  .content-wrapper,
  .theory-wrapper,
  article,
  section {
    margin-top: 0 !important;
    padding-top: 0 !important;
  }

  /* 4.5) ERŐSEBB FELÜLÍRÁSOK: sidebar teljesen ki a flow-ból */
  #sidebar {
    position: fixed !important;
    display: block !important;
    grid-area: none !important;
    margin: 0 !important;
    padding: var(--space-md, 16px) !important;
    /* Minden korábbi layout tulajdonság felülírása */
    width: min(85vw, 360px) !important;
    height: calc(100dvh - var(--header-height, 64px)) !important;
    top: var(--header-height, 64px) !important;
    left: -100vw !important;
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
    z-index: 1100 !important;
    /* FONTOS: ne foglaljon helyet a layout-ban */
    float: none !important;
    background: var(--bg-secondary) !important;
    box-shadow: 20px 0 40px rgba(0,0,0,.35) !important;
    border-right: 1px solid color-mix(in oklab, white 8%, transparent) !important;
    transition:
      left .32s ease,
      opacity .24s ease,
      visibility 0s linear .32s !important;
  }

  /* 5) Extra függőleges hézagok eltávolítása a header alatt */
  .theory-header-spacer,
  #theory-top-toolbar-spacer,
  .toc-sticky-spacer {
    display: none !important;
    height: 0 !important;
    margin: 0 !important;
    padding: 0 !important;
  }
}